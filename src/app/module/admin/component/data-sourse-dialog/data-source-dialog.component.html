<div class="w-full h-full p-1 rounded-md flex flex-col relative">
  <header class="flex-none text-center p-1">
    <mat-icon class="close-button" (click)="dialogRef.close(0)">close</mat-icon>
    Управление источниками данных
  </header>

  <div class="flex-1 p-2 flex">
    <div class="p-2 flex flex-col">
      <mat-icon class="text-info-base cursor-pointer hover:font-bold duration-300" (click)="add()">add_circle_outline
      </mat-icon>
      <mat-icon class="text-error-base cursor-pointer hover:font-bold duration-300" (click)="clearAll()">clear
      </mat-icon>
    </div>
    <div class="dsBoundary border flex-1 relative" #dsField>
      <div class="w-fit absolute" cdkDragBoundary=".dsBoundary" cdkDrag [cdkDragFreeDragPosition]="ds.position"
           (contextmenu)="openMenu($event);isMenuEnter = false"
           (dblclick)="editDataSource()"
           (cdkDragEnded)='dragEnd($event)'
           (mousemove)="currentDataSource = ds"
           (mouseleave)="dsLeave()"
           *ngFor="let ds of localDataSourceList">
        <div [ngClass]=" (currentDataSource && ds.id === currentDataSource.id) ? 'bg-info-base': 'bg-white'"
          class="w-24 p-1  ml-1 border border-white hover:border-primary-light duration-300 rounded-md cursor-move">
          <div class="w-full border border-primary-dark rounded-md flex justify-center items-center bg-white">
            <mat-icon class="text-error-base">http</mat-icon>
          </div>
          <div class="text-xs text-center break-words p-0">{{ ds.name }}</div>
        </div>
      </div>
      <ng-container [ngTemplateOutlet]="dsMenu"></ng-container>
    </div>

  </div>

  <footer class="flex-none border-t border-t-primary-base p-1 flex justify-end items-center">
<!--    <button class="footer-button-style bg-warning-base" (click)="clearAllEvent()"-->
<!--            *ngIf="localDataSourceList.length > 0">Удалить все-->
<!--    </button>-->
    <div class="w-1"></div>
    <button class="footer-button-style " (click)="saveAndClose()">Сохранить</button>
  </footer>
</div>

<ng-template #dsMenu>
  <div *ngIf="dataSourceMenuOpen"
       (mouseenter)="isMenuEnter = true"
       (mouseleave)="dataSourceMenuOpen = false;isMenuEnter = false;currentDataSource = undefined"
       class="border border-primary-light bg-white rounded-md p-2 -mt-1 -ml-1 absolute"
       [ngStyle]="{'left.px': currentDataSource.position.x + menuDeltaX, 'top.px': currentDataSource.position.y + menuDeltaY}">
    <ul class="">
      <li
        class="flex items-center text-black hover:bg-primary-light hover:text-white mt-1 cursor-pointer rounded-sm w-full"
        (click)="editDataSource()">
        <mat-icon class="text-primary-base">edit</mat-icon>
        <span class="ml-2">Редактировать источник данных</span>
      </li>
      <li
        class="flex items-center text-black hover:bg-primary-light hover:text-white mt-1 cursor-pointer rounded-sm w-full"
        (click)="removeDataSource()">
        <mat-icon class="text-warning-base">clear</mat-icon>
        <span class="ml-2">Удалить источник данных</span>
      </li>
    </ul>
  </div>
</ng-template>


